import random
from aiogram import Router, F, types
from aiogram.filters import Command

router = Router()

# –ü–∞–º—è—Ç—å –¥–ª—è —Å–æ–≤–µ—Ç–æ–≤: user_id -> –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Å–æ–≤–µ—Ç
last_tips: dict[int, str] = {}

SECURITY_TIPS = [
    "üîí <b>–°–æ–≤–µ—Ç –¥–Ω—è:</b> –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ø–∞—Ä–æ–ª—å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–∞–π—Ç–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã –ø–∞—Ä–æ–ª–µ–π.",
    "üì± <b>–°–æ–≤–µ—Ç –¥–Ω—è:</b> –í–∫–ª—é—á–∏—Ç–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (2FA) –≤–µ–∑–¥–µ, –≥–¥–µ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ. –≠—Ç–æ –ª—É—á—à–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –≤–∑–ª–æ–º–∞.",
    "üìß <b>–°–æ–≤–µ—Ç –¥–Ω—è:</b> –ù–µ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –≤–ª–æ–∂–µ–Ω–∏—è –≤ –ø–∏—Å—å–º–∞—Ö –æ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –≤—ã–≥–ª—è–¥—è—Ç –∫–∞–∫ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.",
    "üè¶ <b>–°–æ–≤–µ—Ç –¥–Ω—è:</b> –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –±–∞–Ω–∫–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç CVV-–∫–æ–¥ (—Ç—Ä–∏ —Ü–∏—Ñ—Ä—ã –Ω–∞ –æ–±–æ—Ä–æ—Ç–µ –∫–∞—Ä—Ç—ã) –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É.",
    "üîó <b>–°–æ–≤–µ—Ç –¥–Ω—è:</b> –ü—Ä–µ–∂–¥–µ —á–µ–º –∫–ª–∏–∫–Ω—É—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ, –Ω–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –Ω–µ—ë –∫—É—Ä—Å–æ—Ä –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –∫—É–¥–∞ –æ–Ω–∞ –≤–µ–¥–µ—Ç –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ.",
    "üì∂ <b>–°–æ–≤–µ—Ç –¥–Ω—è:</b> –ù–µ –≤–≤–æ–¥–∏—Ç–µ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø–æ–¥–∫–ª—é—á–∏–≤—à–∏—Å—å –∫ –æ—Ç–∫—Ä—ã—Ç–æ–º—É Wi-Fi –≤ –∫–∞—Ñ–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ VPN."
]

@router.message(Command("help"))
async def cmd_help(message: types.Message):
    """
    –í—ã–≤–æ–¥–∏—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ –±–æ—Ç—É.
    """
    text = (
        "ü§ñ <b>–°–ø—Ä–∞–≤–∫–∞ –ø–æ PhishGuard</b>\n\n"
        "–Ø ‚Äî –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.\n\n"
        "<b>üõ° –ú–æ–∏ —Ñ—É–Ω–∫—Ü–∏–∏:</b>\n"
        "1. <b>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤:</b> –û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ –ª—é–±–æ–π –¥–æ–∫—É–º–µ–Ω—Ç (–¥–æ 20 –ú–ë), –∏ —è –ø—Ä–æ—Å–∫–∞–Ω–∏—Ä—É—é –µ–≥–æ —á–µ—Ä–µ–∑ 60+ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–æ–≤.\n"
        "2. <b>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫:</b> –ü—Ä–∏—à–ª–∏—Ç–µ —Å—Å—ã–ª–∫—É –∏–ª–∏ –ø–µ—Ä–µ—à–ª–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–µ–π ‚Äî —è –ø—Ä–æ–≤–µ—Ä—é, –Ω–µ –≤–µ–¥–µ—Ç –ª–∏ –æ–Ω–∞ –Ω–∞ —Ñ–∏—à–∏–Ω–≥–æ–≤—ã–π —Å–∞–π—Ç.\n"
        "3. <b>–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞:</b> –Ø –∏—Å–ø–æ–ª—å–∑—É—é –ò–ò, —á—Ç–æ–±—ã –≤—ã—è–≤–∏—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞ (—Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è, —Å–∫–∞–º) –≤ —Ç–µ–∫—Å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–π.\n"
        "4. <b>–û–±—ä—è—Å–Ω–µ–Ω–∏–µ —É–≥—Ä–æ–∑:</b> –Ø –Ω–µ –ø—Ä–æ—Å—Ç–æ –≥–æ–≤–æ—Ä—é ¬´–û–ø–∞—Å–Ω–æ¬ª, —è –æ–±—ä—è—Å–Ω—è—é –ø–æ—á–µ–º—É –∏ –¥–∞—é —Å–æ–≤–µ—Ç—ã –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º.\n\n"
        "<b>üìù –ö–æ–º–∞–Ω–¥—ã:</b>\n"
        "/start - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞\n"
        "/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ\n"
        "/tips - –ü–æ–ª—É—á–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π —Å–æ–≤–µ—Ç –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
    )
    await message.answer(text, parse_mode="HTML")

@router.message(Command("tips"))
async def cmd_tips(message: types.Message):
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π —Å–æ–≤–µ—Ç, –∏–∑–±–µ–≥–∞—è –ø–æ–≤—Ç–æ—Ä–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
    """
    user_id = message.from_user.id
    last_tip = last_tips.get(user_id)
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ø–∏—Å–æ–∫, —É–±–∏—Ä–∞—è –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–π —Å–æ–≤–µ—Ç
    available_tips = [tip for tip in SECURITY_TIPS if tip != last_tip]
    
    # –í—ã–±–∏—Ä–∞–µ–º –Ω–æ–≤—ã–π —Å–æ–≤–µ—Ç
    new_tip = random.choice(available_tips)
    
    # –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –µ–≥–æ
    last_tips[user_id] = new_tip
    
    await message.answer(new_tip, parse_mode="HTML")
